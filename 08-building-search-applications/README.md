# Створення пошукових застосунків

[![Вступ до генеративного ШІ та великих мовних моделей](./images/08-lesson-banner.png?WT.mc_id=academic-105485-koreyst)](https://aka.ms/gen-ai-lesson8-gh?WT.mc_id=academic-105485-koreyst)

> > _Натисніть на зображення вище, щоб переглянути відео цього уроку_

LLM – це не лише чат-боти та генерація тексту. Також можливо створювати пошукові застосунки, використовуючи вбудовування (Embeddings). Вбудовування – це числове представлення даних, також відомі як вектори, і можуть використовуватися для семантичного пошуку даних.

У цьому уроці ви створите пошуковий застосунок для нашого освітнього стартапу. Наш стартап – це неприбуткова організація, яка надає безкоштовну освіту студентам у країнах, що розвиваються. Наш стартап має велику кількість відео на YouTube, які студенти можуть використовувати для вивчення ШІ. Наш стартап хоче створити пошуковий застосунок, який дозволяє студентам шукати відео на YouTube, ввівши запитання.

Наприклад, студент може ввести "Що таке Jupyter Notebooks?" або "Що таке Azure ML", і пошуковий застосунок поверне список відеороликів на YouTube, що відповідають запитанню, і, що ще краще, пошуковий застосунок поверне посилання на місце у відео, де знаходиться відповідь на запитання.

## Вступ

У цьому уроці ми розглянемо:

- Семантичний пошук проти ключового пошуку.
- Що таке текстові вбудовування.
- Створення індексу текстових вбудовувань.
- Пошук в індексі текстових вбудовувань.

## Цілі навчання

Після завершення цього уроку ви зможете:

- Розрізняти семантичний та ключовий пошук.
- Пояснити, що таке текстові вбудовування.
- Створити застосунок, що використовує вбудовування для пошуку даних.

## Чому варто створити пошуковий застосунок?

Створення пошукового застосунку допоможе вам зрозуміти, як використовувати вбудовування для пошуку даних. Ви також дізнаєтеся, як створити пошуковий застосунок, який студенти можуть використовувати для швидкого пошуку інформації.

Урок містить індекс вбудовувань транскриптів YouTube для каналу Microsoft [AI Show](https://www.youtube.com/playlist?list=PLlrxD0HtieHi0mwteKBOfEeOYf0LJU4O1) на YouTube. AI Show – це канал YouTube, який навчає вас ШІ та машинному навчанню. Індекс вбудовувань містить вбудовування для кожного транскрипту YouTube до жовтня 2023 року. Ви використовуватимете індекс вбудовувань для створення пошукового застосунку для нашого стартапу. Пошуковий застосунок повертає посилання на місце у відео, де знаходиться відповідь на запитання. Це чудовий спосіб для студентів швидко знайти потрібну інформацію.

Ось приклад семантичного запиту на питання "чи можна використовувати rstudio з azure ml?". Перевірте URL-адресу YouTube, ви побачите, що URL-адреса містить часову мітку, яка переносить вас у місце відео, де знаходиться відповідь на запитання.

![Семантичний запит на питання "чи можна використовувати rstudio з Azure ML"](./images/query-results.png?WT.mc_id=academic-105485-koreyst)

## Що таке семантичний пошук?

Тепер ви можете запитати, що таке семантичний пошук? Семантичний пошук – це техніка пошуку, яка використовує семантику або значення слів у запиті для повернення відповідних результатів.

Ось приклад семантичного пошуку. Припустимо, ви шукаєте машину, ви можете шукати "мою машину мрії", семантичний пошук розуміє, що ви не "мрієте" про машину, а скоріше шукаєте свою "ідеальну" машину. Семантичний пошук розуміє ваш намір і повертає відповідні результати. Альтернативою є "ключовий пошук", який буквально шукатиме мрії про автомобілі та часто повертає нерелевантні результати.

## Що таке текстові вбудовування?

[Текстові вбудовування](https://en.wikipedia.org/wiki/Word_embedding?WT.mc_id=academic-105485-koreyst) – це техніка представлення тексту, що використовується в [обробці природної мови](https://en.wikipedia.org/wiki/Natural_language_processing?WT.mc_id=academic-105485-koreyst). Текстові вбудовування – це семантичні числові представлення тексту. Вбудовування використовуються для представлення даних у спосіб, зручний для розуміння машиною. Існує багато моделей для створення текстових вбудовувань, у цьому уроці ми зосередимося на створенні вбудовувань за допомогою моделі вбудовування OpenAI.

Ось приклад, уявіть, що наступний текст міститься в транскрипті одного з епізодів на каналі YouTube AI Show:

```text
Today we are going to learn about Azure Machine Learning.
```

Ми передамо текст до API вбудовування OpenAI, і він поверне наступне вбудовування, що складається з 1536 чисел, тобто вектора. Кожне число у векторі представляє різний аспект тексту. Для короткості, ось перші 10 чисел у векторі.

```python
[-0.006655829958617687, 0.0026128944009542465, 0.008792596869170666, -0.02446001023054123, -0.008540431968867779, 0.022071078419685364, -0.010703742504119873, 0.003311325330287218, -0.011632772162556648, -0.02187200076878071, ...]
```

## Як створюється індекс вбудовувань?

Індекс вбудовувань для цього уроку був створений з серією скриптів Python. Ви знайдете скрипти разом з інструкціями у [README](./scripts/README.md?WT.mc_id=academic-105485-koreyst) в папці 'scripts` для цього уроку. Вам не потрібно запускати ці скрипти для завершення цього уроку, оскільки індекс вбудовувань надається вам.

Скрипти виконують наступні операції:

1. Завантажується транскрипт для кожного відео на YouTube у плейлисті [AI Show](https://www.youtube.com/playlist?list=PLlrxD0HtieHi0mwteKBOfEeOYf0LJU4O1).
2. За допомогою [OpenAI Functions](https://learn.microsoft.com/azure/ai-services/openai/how-to/function-calling?WT.mc_id=academic-105485-koreyst) робиться спроба витягти ім'я доповідача з перших 3 хвилин транскрипту YouTube. Ім'я доповідача для кожного відео зберігається в індексі вбудовувань з назвою `embedding_index_3m.json`.
3. Текст транскрипту потім розбивається на **3-хвилинні текстові сегменти**. Сегмент включає приблизно 20 слів, що перекриваються з наступним сегментом, щоб забезпечити, що вбудовування для сегмента не обрізається, і забезпечити кращий контекст пошуку.
4. Кожен текстовий сегмент потім передається до API чату OpenAI для резюмування тексту до 60 слів. Резюме також зберігається в індексі вбудовувань `embedding_index_3m.json`.
5. Нарешті, текст сегмента передається до API вбудовування OpenAI. API вбудовування повертає вектор з 1536 чисел, які представляють семантичне значення сегмента. Сегмент разом з вектором вбудовування OpenAI зберігається в індексі вбудовувань `embedding_index_3m.json`.

### Векторні бази даних

Для простоти уроку індекс вбудовувань зберігається у JSON-файлі з назвою `embedding_index_3m.json` і завантажується в DataFrame Pandas. Однак на виробництві індекс вбудовувань зберігався б у векторній базі даних, такій як [Azure Cognitive Search](https://learn.microsoft.com/training/modules/improve-search-results-vector-search?WT.mc_id=academic-105485-koreyst), [Redis](https://cookbook.openai.com/examples/vector_databases/redis/readme?WT.mc_id=academic-105485-koreyst), [Pinecone](https://cookbook.openai.com/examples/vector_databases/pinecone/readme?WT.mc_id=academic-105485-koreyst), [Weaviate](https://cookbook.openai.com/examples/vector_databases/weaviate/readme?WT.mc_id=academic-105485-koreyst), щоб назвати лише деякі.

## Розуміння косинусної подібності

Ми дізналися про текстові вбудовування, наступним кроком є дізнатися, як використовувати текстові вбудовування для пошуку даних, і зокрема знайти найбільш схожі вбудовування до заданого запиту, використовуючи косинусну подібність.

### Що таке косинусна подібність?

Косинусна подібність – це міра схожості між двома векторами, ви також почуєте, що це називається "пошуком найближчого сусіда". Щоб виконати пошук косинусної подібності, вам потрібно _векторизувати_ текст _запиту_, використовуючи API вбудовування OpenAI. Потім обчислити _косинусну подібність_ між вектором запиту та кожним вектором в індексі вбудовувань. Пам'ятайте, що індекс вбудовувань має вектор для кожного сегмента тексту транскрипту YouTube. Нарешті, відсортувати результати за косинусною подібністю, і текстові сегменти з найвищою косинусною подібністю є найбільш схожими на запит.

З математичної точки зору, косинусна подібність вимірює косинус кута між двома векторами, спроектованими в багатовимірному просторі. Цей вимір корисний, тому що якщо два документи далеко один від одного за евклідовою відстанню через розмір, вони все ще можуть мати менший кут між ними і, отже, вищу косинусну подібність. Для отримання додаткової інформації про рівняння косинусної подібності, див. [Косинусна подібність](https://en.wikipedia.org/wiki/Cosine_similarity?WT.mc_id=academic-105485-koreyst).

## Створення першого пошукового застосунку

Далі ми дізнаємося, як створити пошуковий застосунок, використовуючи вбудовування. Пошуковий застосунок дозволить студентам шукати відео, ввівши запитання. Пошуковий застосунок поверне список відео, що відповідають запитанню. Пошуковий застосунок також поверне посилання на місце у відео, де знаходиться відповідь на запитання.

Це рішення було створено і протестовано на Windows 11, macOS та Ubuntu 22.04 з використанням Python 3.10 або пізнішої версії. Ви можете завантажити Python з [python.org](https://www.python.org/downloads/?WT.mc_id=academic-105485-koreyst).

## Завдання - створення пошукового застосунку для студентів

Ми представили наш стартап на початку цього уроку. Тепер настав час дати можливість студентам створити пошуковий застосунок для їхніх оцінювань.

У цьому завданні ви створите сервіси Azure OpenAI, які будуть використовуватися для створення пошукового застосунку. Ви створите наступні сервіси Azure OpenAI. Вам потрібна підписка Azure для виконання цього завдання.

### Запуск Azure Cloud Shell

1. Увійдіть на [портал Azure](https://portal.azure.com/?WT.mc_id=academic-105485-koreyst).
2. Виберіть значок Cloud Shell у верхньому правому куті порталу Azure.
3. Виберіть **Bash** для типу середовища.

#### Створення групи ресурсів

> Для цих інструкцій ми використовуємо групу ресурсів з назвою "semantic-video-search" у East US.
> Ви можете змінити назву групи ресурсів, але при зміні місцезнаходження для ресурсів,
> перевірте [таблицю доступності моделей](https://aka.ms/oai/models?WT.mc_id=academic-105485-koreyst).

```shell
az group create --name semantic-video-search --location eastus
```

#### Створення ресурсу сервісу Azure OpenAI

З Azure Cloud Shell виконайте наступну команду для створення ресурсу сервісу Azure OpenAI.

```shell
az cognitiveservices account create --name semantic-video-openai --resource-group semantic-video-search \
    --location eastus --kind OpenAI --sku s0
```

#### Отримання кінцевої точки та ключів для використання в цьому застосунку

З Azure Cloud Shell виконайте наступні команди, щоб отримати кінцеву точку та ключі для ресурсу сервісу Azure OpenAI.

```shell
az cognitiveservices account show --name semantic-video-openai \
   --resource-group  semantic-video-search | jq -r .properties.endpoint
az cognitiveservices account keys list --name semantic-video-openai \
   --resource-group semantic-video-search | jq -r .key1
```

#### Розгортання моделі вбудовування OpenAI

З Azure Cloud Shell виконайте наступну команду для розгортання моделі вбудовування OpenAI.

```shell
az cognitiveservices account deployment create \
    --name semantic-video-openai \
    --resource-group  semantic-video-search \
    --deployment-name text-embedding-ada-002 \
    --model-name text-embedding-ada-002 \
    --model-version "2"  \
    --model-format OpenAI \
    --sku-capacity 100 --sku-name "Standard"
```

## Рішення

Відкрийте [записник рішення](./python/aoai-solution.ipynb?WT.mc_id=academic-105485-koreyst) у GitHub Codespaces і дотримуйтесь інструкцій у Jupyter Notebook.

Коли ви запустите записник, вам буде запропоновано ввести запит. Поле введення виглядатиме так:

![Поле введення для користувача для введення запиту](./images/notebook-search.png?WT.mc_id=academic-105485-koreyst)

## Чудова робота! Продовжуйте навчання

Після завершення цього уроку перегляньте нашу [колекцію навчання генеративного ШІ](https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst), щоб продовжити підвищувати ваші знання генеративного ШІ!

Переходьте до Уроку 9, де ми розглянемо, як [створювати застосунки для генерації зображень](../09-building-image-applications/README.md?WT.mc_id=academic-105485-koreyst)!