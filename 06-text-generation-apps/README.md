# Створення застосунків для генерації тексту

[![Створення застосунків для генерації тексту](./images/06-lesson-banner.png?WT.mc_id=academic-105485-koreyst)](https://aka.ms/gen-ai-lesson6-gh?WT.mc_id=academic-105485-koreyst)

> _(Натисніть на зображення вище, щоб переглянути відео цього уроку)_

Ви вже бачили в цьому курсі, що існують основні концепції, такі як промпти, і навіть цілий напрямок під назвою "інженерія промптів". Багато інструментів, з якими ви можете взаємодіяти, як-от ChatGPT, Office 365, Microsoft Power Platform тощо, підтримують використання промптів для виконання певних завдань.

Щоб додати такий функціонал до застосунку, вам потрібно розуміти концепції, як-от промпти, доповнення, та вибрати бібліотеку для роботи. Саме це ви й вивчите в цьому розділі.

## Вступ

У цьому розділі ви:

- Дізнаєтесь про бібліотеку openai та її основні концепції.
- Створите застосунок для генерації тексту за допомогою openai.
- Зрозумієте, як використовувати такі концепції як промпт, температура та токени для створення застосунку генерації тексту.

## Цілі навчання

Наприкінці цього уроку ви зможете:

- Пояснити, що таке застосунок для генерації тексту.
- Створити застосунок для генерації тексту за допомогою openai.
- Налаштувати свій застосунок на використання більшої чи меншої кількості токенів, а також змінювати температуру для отримання різноманітніших результатів.

## Що таке застосунок для генерації тексту?

Зазвичай, коли ви створюєте застосунок, він має якийсь інтерфейс, наприклад:

- Командний інтерфейс. Консольні програми - це типові застосунки, де ви вводите команду, і вона виконує завдання. Наприклад, `git` - це застосунок з командним інтерфейсом.
- Користувацький інтерфейс (UI). Деякі застосунки мають графічний користувацький інтерфейс (GUI), де ви натискаєте кнопки, вводите текст, вибираєте опції тощо.

### Консольні та UI застосунки мають обмеження

Порівняйте це з застосунком на основі команд, де ви вводите команду:

- **Він обмежений**. Ви не можете просто ввести будь-яку команду, тільки ті, які підтримує застосунок.
- **Залежність від мови**. Деякі застосунки підтримують багато мов, але за замовчуванням застосунок створюється для конкретної мови, навіть якщо ви можете додати підтримку інших мов.

### Переваги застосунків для генерації тексту

Отже, чим відрізняється застосунок для генерації тексту?

У застосунку для генерації тексту ви маєте більше гнучкості, ви не обмежені набором команд чи конкретною мовою введення. Натомість ви можете використовувати природну мову для взаємодії з застосунком. Ще однією перевагою є те, що ви вже взаємодієте з джерелом даних, яке було навчене на величезному корпусі інформації, тоді як традиційний застосунок може бути обмежений тим, що є в базі даних.

### Що я можу створити за допомогою застосунку для генерації тексту?

Є багато речей, які ви можете створити. Наприклад:

- **Чатбот**. Чатбот, що відповідає на запитання про теми, як-от ваша компанія та її продукти, може бути хорошим варіантом.
- **Помічник**. LLM чудово справляються з такими завданнями, як узагальнення тексту, отримання інсайтів з тексту, створення текстів, як-от резюме тощо.
- **Помічник з кодування**. Залежно від моделі мови, яку ви використовуєте, ви можете створити помічника з кодування, який допомагає вам писати код. Наприклад, ви можете використовувати такий продукт, як GitHub Copilot, а також ChatGPT, щоб допомогти вам писати код.

## Як почати?

Що ж, вам потрібно знайти спосіб інтеграції з LLM, що зазвичай передбачає такі два підходи:

- Використання API. Тут ви створюєте веб-запити з вашим промптом і отримуєте згенерований текст у відповідь.
- Використання бібліотеки. Бібліотеки допомагають інкапсулювати API-виклики та зробити їх простішими у використанні.

## Бібліотеки/SDK

Є кілька відомих бібліотек для роботи з LLM, такі як:

- **openai**, ця бібліотека полегшує підключення до вашої моделі та надсилання промптів.

Також є бібліотеки, що працюють на вищому рівні, як-от:

- **Langchain**. Langchain добре відомий і підтримує Python.
- **Semantic Kernel**. Semantic Kernel - це бібліотека від Microsoft, що підтримує мови C#, Python та Java.

## Перший застосунок з використанням openai

Давайте подивимось, як ми можемо створити наш перший застосунок, які бібліотеки нам потрібні, скільки всього потрібно і так далі.

### Встановлення openai

Існує багато бібліотек для взаємодії з OpenAI або Azure OpenAI. Можливо використовувати різні мови програмування, такі як C#, Python, JavaScript, Java тощо. Ми обрали використовувати бібліотеку `openai` для Python, тому встановимо її за допомогою `pip`.

```bash
pip install openai
```
### Створення ресурсу

Вам потрібно виконати наступні кроки:

- Створіть обліковий запис на Azure [https://azure.microsoft.com/free/](https://azure.microsoft.com/free/?WT.mc_id=academic-105485-koreyst).
- Отримайте доступ до Azure OpenAI. Перейдіть за посиланням [https://learn.microsoft.com/azure/ai-services/openai/overview#how-do-i-get-access-to-azure-openai](https://learn.microsoft.com/azure/ai-services/openai/overview#how-do-i-get-access-to-azure-openai?WT.mc_id=academic-105485-koreyst) та подайте заявку на доступ.

  > [!ПРИМІТКА]
  > На момент написання цього матеріалу потрібно подати заявку на доступ до Azure OpenAI.

- Встановіть Python <https://www.python.org/>
- Створіть ресурс Azure OpenAI Service. Дивіться це керівництво про те, як [створити ресурс](https://learn.microsoft.com/azure/ai-services/openai/how-to/create-resource?pivots=web-portal?WT.mc_id=academic-105485-koreyst).

### Знаходження API-ключа та кінцевої точки

На цьому етапі вам потрібно повідомити вашій бібліотеці `openai`, який API-ключ використовувати. Щоб знайти свій API-ключ, перейдіть до розділу "Keys and Endpoint" вашого ресурсу Azure OpenAI та скопіюйте значення "Key 1".

![Розділ Keys and Endpoint ресурсу в Azure Portal](https://learn.microsoft.com/azure/ai-services/openai/media/quickstarts/endpoint.png?WT.mc_id=academic-105485-koreyst)

Тепер, коли ви скопіювали цю інформацію, давайте налаштуємо бібліотеки для її використання.

> [!ПРИМІТКА]
> Варто відокремлювати ваш API-ключ від коду. Ви можете зробити це за допомогою змінних середовища.
>
> - Встановіть змінну середовища `OPENAI_API_KEY` зі значенням вашого API-ключа.
>   `export OPENAI_API_KEY='sk-...'`

### Налаштування конфігурації Azure

Якщо ви використовуєте Azure OpenAI, ось як налаштувати конфігурацію:

```python
openai.api_type = 'azure'
openai.api_key = os.environ["OPENAI_API_KEY"]
openai.api_version = '2023-05-15'
openai.api_base = os.getenv("API_BASE")
```

Вище ми встановлюємо наступне:

- `api_type` як `azure`. Це вказує бібліотеці використовувати Azure OpenAI, а не OpenAI.
- `api_key`, це ваш API-ключ, знайдений в Azure Portal.
- `api_version`, це версія API, яку ви хочете використовувати. На момент написання цього матеріалу остання версія - `2023-05-15`.
- `api_base`, це кінцева точка API. Ви можете знайти її в Azure Portal поруч з вашим API-ключем.

> [!ПРИМІТКА] > `os.getenv` - це функція, яка читає змінні середовища. Ви можете використовувати її для читання змінних середовища, таких як `OPENAI_API_KEY` та `API_BASE`. Встановіть ці змінні середовища у вашому терміналі або за допомогою бібліотеки на зразок `dotenv`.

## Генерація тексту

Способом генерації тексту є використання класу `Completion`. Ось приклад:

```python
prompt = "Завершіть наступне: Одного разу був"

completion = openai.Completion.create(model="davinci-002", prompt=prompt)
print(completion.choices[0].text)
```

У наведеному вище коді ми створюємо об'єкт completion і передаємо модель, яку хочемо використовувати, та промпт. Потім ми друкуємо згенерований текст.

### Чат-доповнення

Досі ви бачили, як ми використовували `Completion` для генерації тексту. Але є інший клас під назвою `ChatCompletion`, який більше підходить для чатботів. Ось приклад його використання:

```python
import openai

openai.api_key = "sk-..."

completion = openai.ChatCompletion.create(model="gpt-3.5-turbo", messages=[{"role": "user", "content": "Привіт світ"}])
print(completion.choices[0].message.content)
```

Більше про цю функціональність у наступному розділі.

## Вправа - ваш перший застосунок для генерації тексту

Тепер, коли ми дізналися, як налаштувати та сконфігурувати openai, час створити ваш перший застосунок для генерації тексту. Щоб створити ваш застосунок, виконайте наступні кроки:

1. Створіть віртуальне середовище та встановіть openai:

   ```bash
   python -m venv venv
   source venv/bin/activate
   pip install openai
   ```

   > [!ПРИМІТКА]
   > Якщо ви використовуєте Windows, введіть `venv\Scripts\activate` замість `source venv/bin/activate`.

   > [!ПРИМІТКА]
   > Знайдіть свій ключ Azure OpenAI, перейшовши на [https://portal.azure.com/](https://portal.azure.com/?WT.mc_id=academic-105485-koreyst), знайдіть `Open AI`, виберіть ресурс `Open AI`, потім виберіть `Keys and Endpoint` і скопіюйте значення `Key 1`.

1. Створіть файл _app.py_ і додайте до нього наступний код:

   ```python
   import openai

   openai.api_key = "<замініть це значення вашим ключем open ai або ключем Azure OpenAI>"

   openai.api_type = 'azure'
   openai.api_version = '2023-05-15'
   openai.api_base = "<кінцева точка з Azure Portal, де знаходиться ваш API-ключ>"
   deployment_name = "<назва розгортання>"

   # додайте ваш код доповнення
   prompt = "Завершіть наступне: Одного разу був"
   messages = [{"role": "user", "content": prompt}]

   # створіть доповнення
   completion = client.chat.completions.create(model=deployment, messages=messages)

   # надрукуйте відповідь
   print(completion.choices[0].message.content)
   ```

   > [!ПРИМІТКА]
   > Якщо ви використовуєте Azure OpenAI, вам потрібно встановити `api_type` як `azure` та встановити `api_key` як ваш ключ Azure OpenAI.

   Ви повинні побачити вивід, схожий на наступний:

   ```output
    дуже нещасний _____.

   Одного разу була дуже нещасна русалка.
   ```

   ## Різні типи промптів для різних завдань

Тепер ви бачили, як генерувати текст за допомогою промпту. У вас навіть є працюючий застосунок, який ви можете модифікувати та змінювати для генерації різних типів тексту.

Промпти можна використовувати для різноманітних завдань. Наприклад:

- **Генерація певного типу тексту**. Наприклад, ви можете згенерувати вірш, питання для вікторини тощо.
- **Пошук інформації**. Ви можете використовувати промпти для пошуку інформації, наприклад 'Що означає CORS у веб-розробці?'.
- **Генерація коду**. Ви можете використовувати промпти для генерації коду, наприклад, створення регулярного виразу для перевірки електронних адрес або навіть генерації цілого застосунку, як-от веб-застосунок.

## Більш практичний випадок: генератор рецептів

Уявіть, що у вас вдома є інгредієнти і ви хочете щось приготувати. Для цього вам потрібен рецепт. Один зі способів знайти рецепти - використати пошукову систему, або ви можете використати LLM для цього.

Ви могли б написати промпт такого типу:

> "Покажіть мені 5 рецептів страви з наступними інгредієнтами: курка, картопля та морква. Для кожного рецепту перелічіть всі використані інгредієнти"

За таким промптом ви можете отримати відповідь на зразок:

```output
1. Запечена курка з овочами:
Інгредієнти:
- 4 курячих стегна
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 2 столові ложки оливкової олії
- 2 зубчики часнику, подрібнені
- 1 чайна ложка сушеного чебрецю
- 1 чайна ложка сушеного орегано
- Сіль та перець за смаком

2. Курячий суп з картоплею:
Інгредієнти:
- 2 столові ложки оливкової олії
- 1 цибулина, нарізана
- 2 зубчики часнику, подрібнені
- 2 курячі грудки, нарізані кубиками
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 1 чайна ложка сушеного орегано
- 1 чайна ложка сушеного чебрецю
- 1 склянка курячого бульйону
- Сіль та перець за смаком

[продовження рецептів...]
```

Це чудовий результат, я знаю, що приготувати. На цьому етапі корисними покращеннями могли б бути:

- Відфільтрування інгредієнтів, які я не люблю або на які маю алергію.
- Створення списку покупок, якщо у мене вдома немає всіх інгредієнтів.

Для цих випадків, давайте додамо додатковий промпт:

> "Будь ласка, видаліть рецепти з часником, оскільки я маю на нього алергію, та замініть його чимось іншим. Також, будь ласка, створіть список покупок для рецептів, враховуючи, що у мене вже є курка, картопля та морква вдома."

Тепер ви отримаєте новий результат, а саме:

```output
1. Запечена курка з овочами:
Інгредієнти:
- 4 курячих стегна
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 2 столові ложки оливкової олії
- 1 чайна ложка сушеного чебрецю
- 1 чайна ложка сушеного орегано
- Сіль та перець за смаком

2. Курячий суп з картоплею:
Інгредієнти:
- 2 столові ложки оливкової олії
- 1 цибулина, нарізана
- 2 курячі грудки, нарізані кубиками
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 1 чайна ложка сушеного орегано
- 1 чайна ложка сушеного чебрецю
- 1 склянка курячого бульйону
- Сіль та перець за смаком

3. Запечена курка з картоплею:
Інгредієнти:
- 2 столові ложки оливкової олії
- 2 курячі грудки, нарізані кубиками
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 1 цибулина, нарізана
- 1 чайна ложка сушеного орегано
- 1 чайна ложка сушеного чебрецю
- 1 склянка курячого бульйону
- Сіль та перець за смаком

4. Курячий суп:
Інгредієнти:
- 2 столові ложки оливкової олії
- 1 цибулина, нарізана
- 2 курячі грудки, нарізані кубиками
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 1 чайна ложка сушеного орегано
- 1 чайна ложка сушеного чебрецю
- 4 склянки курячого бульйону
- Сіль та перець за смаком

5. Картопляний хеш з куркою:
Інгредієнти:
- 2 столові ложки оливкової олії
- 2 курячі грудки, нарізані кубиками
- 2 картоплини, нарізані кубиками
- 2 моркви, нарізані кубиками
- 1 цибулина, нарізана
- 1 чайна ложка сушеного орегано

Список покупок:
- Оливкова олія
- Цибуля
- Чебрець
- Орегано
- Сіль
- Перець
```

Це ваші п'ять рецептів, без згадки часнику, і у вас також є список покупок, враховуючи те, що вже є вдома.

## Вправа - створення генератора рецептів

Тепер, коли ми розглянули сценарій, давайте напишемо код, що відповідає продемонстрованому сценарію. Для цього виконайте наступні кроки:

1. Використайте існуючий файл _app.py_ як відправну точку
1. Знайдіть змінну `prompt` та змініть її код на наступний:

   ```python
   prompt = "Покажіть мені 5 рецептів страви з наступними інгредієнтами: курка, картопля та морква. Для кожного рецепту перелічіть всі використані інгредієнти"
   ```

   Якщо ви тепер запустите код, ви повинні побачити вивід, схожий на:

   ```output
   -Курячий суп з картоплею та морквою: 3 столові ложки олії, 1 цибулина, подрібнена, 2 зубчики часнику, подрібнені, 1 морква, очищена та нарізана, 1 картоплина, очищена та нарізана, 1 лавровий лист, 1 гілочка чебрецю, 1/2 чайної ложки солі, 1/4 чайної ложки чорного перцю, 1 1/2 склянки курячого бульйону, 1/2 склянки білого сухого вина, 2 столові ложки подрібненої свіжої петрушки, 2 столові ложки вершкового масла, 1 1/2 фунта курячих стегон без кісток і шкіри, нарізаних кубиками по 1 дюйму

   -Запечена курка з картоплею та морквою: 3 столові ложки оливкової олії першого віджиму, 1 столова ложка дижонської гірчиці, 1 столова ложка подрібненого свіжого розмарину, 1 столова ложка подрібненого свіжого чебрецю, 4 зубчики часнику, подрібнені, 1 1/2 фунта дрібної червоної картоплі, нарізаної четвертинками, 1 1/2 фунта моркви, нарізаної вздовж на четвертинки, 1/2 чайної ложки солі, 1/4 чайної ложки чорного перцю, 1 (4-фунтова) ціла курка

   -Куряча, картопляна та морквяна запіканка: кулінарний спрей, 1 велика цибулина, подрібнена, 2 зубчики часнику, подрібнені, 1 морква, очищена та натерта, 1 картоплина, очищена та натерта, 1/2 чайної ложки сушеного чебрецю, 1/4 чайної ложки солі, 1/4 чайної ложки чорного перцю, 2 склянки знежиреного курячого бульйону з низьким вмістом натрію, 1 склянка замороженого горошку, 1/4 склянки борошна, 1 склянка молока 2% жирності, 1/4 склянки тертого сиру пармезан

   -Курячий та картопляний обід в одній каструлі: 2 столові ложки оливкової олії, 1 фунт курячих стегон без кісток і шкіри, нарізаних кубиками по 1 дюйму, 1 велика цибулина, подрібнена, 3 зубчики часнику, подрібнені, 1 морква, очищена та подрібнена, 1 картоплина, очищена та подрібнена, 1 лавровий лист, 1 гілочка чебрецю, 1/2 чайної ложки солі, 1/4 чайної ложки чорного перцю, 2 склянки курячого бульйону, 1/2 склянки білого сухого вина

   -Куряче, картопляне та морквяне каррі: 1 столова ложка рослинної олії, 1 велика цибулина, подрібнена, 2 зубчики часнику, подрібнені, 1 морква, очищена та подрібнена, 1 картоплина, очищена та подрібнена, 1 чайна ложка меленого коріандру, 1 чайна ложка меленого кмину, 1/2 чайної ложки куркуми, 1/2 чайної ложки меленого імбиру, 1/4 чайної ложки кайєнського перцю, 2 склянки курячого бульйону, 1/2 склянки білого сухого вина, 1 (15-унцієва) банка нуту, промитого та висушеного, 1/2 склянки родзинок, 1/2 склянки подрібненої свіжої кінзи
   ```

   > ПРИМІТКА, ваша LLM є недетермінованою, тому ви можете отримувати різні результати щоразу, коли запускаєте програму.

   Чудово, давайте подивимось, як ми можемо покращити речі. Щоб покращити речі, ми хочемо зробити код гнучким, щоб інгредієнти та кількість рецептів можна було змінювати.

   1. Давайте змінимо код наступним чином:

   ```python
   no_recipes = input("Кількість рецептів (наприклад, 5): ")

   ingredients = input("Список інгредієнтів (наприклад, курка, картопля та морква): ")

   # інтерполюємо кількість рецептів у промпт та інгредієнти
   prompt = f"Покажіть мені {no_recipes} рецептів страви з наступними інгредієнтами: {ingredients}. Для кожного рецепту перелічіть всі використані інгредієнти"
   ```

   Тестовий запуск коду може виглядати так:

   ```output
   Кількість рецептів (наприклад, 5): 3
   Список інгредієнтів (наприклад, курка, картопля та морква): молоко,полуниця

   -Молочний коктейль з полуницею: молоко, полуниця, цукор, ванільний екстракт, кубики льоду
   -Полуничний торт: молоко, борошно, розпушувач, цукор, сіль, несолене масло, полуниця, збиті вершки
   -Полуничне молоко: молоко, полуниця, цукор, ванільний екстракт
   ```

### Покращення за допомогою фільтрації та списку покупок

Тепер у нас є працюючий застосунок, здатний створювати рецепти, і він гнучкий, оскільки покладається на введення користувача як щодо кількості рецептів, так і щодо використовуваних інгредієнтів.

Для подальшого вдосконалення ми хочемо додати наступне:

- **Фільтрація інгредієнтів**. Ми хочемо мати можливість відфільтровувати інгредієнти, які нам не подобаються або на які у нас алергія. Щоб досягти цієї зміни, ми можемо відредагувати наш існуючий промпт і додати умову фільтрації в його кінець, ось так:

  ```python
  filter = input("Фільтр (наприклад, вегетаріанський, веганський або без глютену): ")

  prompt = f"Покажіть мені {no_recipes} рецептів страви з наступними інгредієнтами: {ingredients}. Для кожного рецепту перелічіть всі використані інгредієнти, без {filter}"
  ```

  Вище ми додаємо `{filter}` в кінець промпту, а також отримуємо значення фільтра від користувача.

  Приклад введення при запуску програми тепер може виглядати так:

  ```output
   Кількість рецептів (наприклад, 5): 3
   Список інгредієнтів (наприклад, курка, картопля та морква): цибуля,молоко
   Фільтр (наприклад, вегетаріанський, веганський або без глютену): молоко

   1. Французький цибулевий суп

   Інгредієнти:

   -1 велика цибулина, нарізана
   -3 склянки яловичого бульйону
   -1 склянка молока
   -6 скибочок французького хліба
   -1/4 склянки тертого сиру пармезан
   -1 столова ложка масла
   -1 чайна ложка сушеного чебрецю
   -1/4 чайної ложки солі
   -1/4 чайної ложки чорного перцю

   Інструкції:

   1. У великій каструлі обсмажте цибулю в маслі до золотистого кольору.
   2. Додайте яловичий бульйон, молоко, чебрець, сіль та перець. Доведіть до кипіння.
   3. Зменшіть вогонь і варіть 10 хвилин.
   4. Покладіть скибочки французького хліба в суповi тарілки.
   5. Налийте суп поверх хліба.
   6. Посипте сиром пармезан.

   2. Цибулевий суп з картоплею

   Інгредієнти:

   -1 велика цибулина, подрібнена
   -2 склянки картоплі, нарізаної кубиками
   -3 склянки овочевого бульйону
   -1 склянка молока
   -1/4 чайної ложки чорного перцю

   Інструкції:

   1. У великій каструлі обсмажте цибулю в маслі до золотистого кольору.
   2. Додайте картоплю, овочевий бульйон, молоко та перець. Доведіть до кипіння.
   3. Зменшіть вогонь і варіть 10 хвилин.
   4. Подавайте гарячим.

   3. Вершковий цибулевий суп

   Інгредієнти:

   -1 велика цибулина, подрібнена
   -3 склянки овочевого бульйону
   -1 склянка молока
   -1/4 чайної ложки чорного перцю
   -1/4 склянки борошна
   -1/2 склянки тертого сиру пармезан

   Інструкції:

   1. У великій каструлі обсмажте цибулю в маслі до золотистого кольору.
   2. Додайте овочевий бульйон, молоко та перець. Доведіть до кипіння.
   3. Зменшіть вогонь і варіть 10 хвилин.
   4. В маленькій мисці змішайте борошно та сир пармезан до однорідності.
   5. Додайте до супу і варіть ще 5 хвилин або до загустіння супу.
   ```

   Як бачите, всі рецепти з молоком були відфільтровані. Але якщо у вас непереносимість лактози, ви можете захотіти відфільтрувати також рецепти з сиром, тому потрібно бути точнішим.

- **Створення списку покупок**. Ми хочемо створити список покупок, враховуючи те, що вже є вдома.

  Для цієї функціональності ми могли б спробувати вирішити все в одному промпті або розділити його на два промпти. Давайте спробуємо другий підхід. Тут ми пропонуємо додати додатковий промпт, але для цього нам потрібно додати результат попереднього промпту як контекст до наступного промпту.

  Знайдіть частину коду, яка виводить результат першого промпту, і додайте наступний код нижче:

  ```python
  old_prompt_result = completion.choices[0].message.content
  prompt = "Створіть список покупок для згенерованих рецептів і, будь ласка, не включайте інгредієнти, які в мене вже є."

  new_prompt = f"{old_prompt_result} {prompt}"
  messages = [{"role": "user", "content": new_prompt}]
  completion = openai.Completion.create(engine=deployment_name, messages=messages, max_tokens=1200)

  # виведення відповіді
  print("Список покупок:")
  print(completion.choices[0].message.content)
  ```

  Зверніть увагу на наступне:

  1. Ми створюємо новий промпт, додаючи результат першого промпту до нового промпту:

     ```python
     new_prompt = f"{old_prompt_result} {prompt}"
     ```

  1. Ми робимо новий запит, але також враховуємо кількість токенів, які ми запитували в першому промпті, тому цього разу ми встановлюємо `max_tokens` як 1200.

     ```python
     completion = openai.Completion.create(engine=deployment_name, prompt=new_prompt, max_tokens=1200)
     ```

     Запустивши цей код, ми отримаємо наступний вивід:

     ```output
     Кількість рецептів (наприклад, 5): 2
     Список інгредієнтів (наприклад, курка, картопля та морква): яблуко,борошно
     Фільтр (наприклад, вегетаріанський, веганський або без глютену): цукор


     -Яблучні панкейки: 1 склянка борошна, 1/2 ч.л. розпушувача, 1/2 ч.л. соди, 1/4 ч.л. солі, 1 ст.л. цукру, 1 яйце, 1 склянка пахти або кислого молока, 1/4 склянки розтопленого масла, 1 яблуко сорту Гренні Сміт, очищене та натерте
     -Яблучні оладки: 1-1/2 склянки борошна, 1 ч.л. розпушувача, 1/4 ч.л. солі, 1/4 ч.л. соди, 1/4 ч.л. мускатного горіха, 1/4 ч.л. кориці, 1/4 ч.л. духмяного перцю, 1/4 склянки цукру, 1/4 склянки рослинного жиру, 1/4 склянки молока, 1 яйце, 2 склянки подрібнених очищених яблук
     Список покупок:
     -Борошно, розпушувач, сода, сіль, цукор, яйце, пахта, масло, яблуко, мускатний горіх, кориця, духмяний перець
     ```

     ## Покращення вашого налаштування

Те, що ми маємо на даний момент - це код, який працює, але є деякі налаштування, які ми повинні зробити для подальшого вдосконалення. Ось що ми повинні зробити:

- **Відокремити секрети від коду**, такі як API-ключ. Секрети не повинні знаходитися в коді і мають зберігатися в безпечному місці. Щоб відокремити секрети від коду, ми можемо використовувати змінні середовища та бібліотеки на кшталт `python-dotenv` для їх завантаження з файлу. Ось як це виглядатиме в коді:

  1. Створіть файл `.env` з наступним вмістом:

     ```bash
     OPENAI_API_KEY=sk-...
     ```

     > Примітка: для Azure вам потрібно встановити наступні змінні середовища:

     ```bash
     OPENAI_API_TYPE=azure
     OPENAI_API_VERSION=2023-05-15
     OPENAI_API_BASE=<замініть>
     ```

     В коді ви б завантажували змінні середовища так:

     ```python
     from dotenv import load_dotenv

     load_dotenv()

     openai.api_key = os.environ["OPENAI_API_KEY"]
     ```

- **Слово про довжину токенів**. Ми повинні враховувати, скільки токенів нам потрібно для генерації бажаного тексту. Токени коштують грошей, тому де можливо, ми повинні намагатися бути економними з кількістю використовуваних токенів. Наприклад, чи можемо ми сформулювати промпт так, щоб використовувати менше токенів?

  Щоб змінити кількість використовуваних токенів, ви можете використовувати параметр `max_tokens`. Наприклад, якщо ви хочете використовувати 100 токенів, ви б зробили так:

  ```python
  completion = client.chat.completions.create(model=deployment, messages=messages, max_tokens=100)
  ```

- **Експерименти з температурою**. Температура - це те, про що ми досі не згадували, але це важливий контекст для того, як працює наша програма. Чим вище значення температури, тим більш випадковим буде вивід. І навпаки, чим нижче значення температури, тим більш передбачуваним буде вивід. Подумайте, чи хочете ви варіації у вашому виводі чи ні.

  Щоб змінити температуру, ви можете використовувати параметр `temperature`. Наприклад, якщо ви хочете використовувати температуру 0.5, ви б зробили так:

  ```python
  completion = client.chat.completions.create(model=deployment, messages=messages, temperature=0.5)
  ```

  > Примітка: чим ближче до 1.0, тим більш різноманітним буде вивід.

  ## Завдання

Для цього завдання ви можете вибрати, що створювати.

Ось кілька пропозицій:

- Вдосконалити генератор рецептів, щоб покращити його ще більше. Поекспериментуйте з значеннями температури та промптами, щоб побачити, що у вас вийде.
- Створити "помічника в навчанні". Цей застосунок повинен вміти відповідати на питання про певну тему, наприклад Python, ви могли б мати промпти на кшталт "Що таке певна тема в Python?", або ви могли б мати промпт, який каже "покажи мені код для певної теми" тощо.
- Історичний бот, оживіть історію, накажіть боту грати роль певного історичного персонажа і задавайте йому питання про його життя та часи.

## Рішення

### Помічник у навчанні

Нижче наведено початковий промпт, подивіться, як ви можете використовувати його та налаштувати під свої потреби.

```text
- "Ви експерт з мови Python

    Запропонуйте урок для початківців з Python у наступному форматі:

    Формат:
    - концепції:
    - короткий опис уроку:
    - вправа в коді з рішеннями"
```

### Історичний бот

Ось кілька промптів, які ви могли б використовувати:

```text
- "Ви Авраам Лінкольн, розкажіть про себе в 3 реченнях, і відповідайте, використовуючи граматику та слова, які б використовував Ейб"
- "Ви Авраам Лінкольн, відповідайте, використовуючи граматику та слова, які б використовував Ейб:

   Розкажіть про свої найбільші досягнення, в 300 словах"
```

## Перевірка знань

Що робить концепція температури?

1. Вона контролює, наскільки випадковим є вивід.
1. Вона контролює, наскільки великою є відповідь.
1. Вона контролює, скільки токенів використовується.

## 🚀 Завдання

Працюючи над завданням, спробуйте змінювати температуру, встановіть її на 0, 0.5 та 1. Пам'ятайте, що 0 - це найменш різноманітний варіант, а 1 - найбільш різноманітний, яке значення найкраще працює для вашого застосунку?

## Чудова робота! Продовжуйте навчання

Після завершення цього уроку перегляньте нашу [колекцію навчальних матеріалів з Генеративного ШІ](https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst), щоб продовжити вдосконалювати свої знання з Генеративного ШІ!

Переходьте до Уроку 7, де ми розглянемо, як [створювати чат-застосунки](../07-building-chat-applications/README.md?WT.mc_id=academic-105485-koreyst)!