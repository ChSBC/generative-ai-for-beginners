# %% [markdown]
# # Створення додатків для генерації тексту
# 
# Ви вже бачили протягом цього курсу, що існують основні концепції, такі як запити, і навіть ціла дисципліна, яка називається "інженерія запитів". Багато інструментів, з якими ви можете взаємодіяти, як-от ChatGPT, Office 365, Microsoft Power Platform тощо, підтримують використання запитів для досягнення мети.
# 
# Щоб додати такий досвід у додаток, вам потрібно розуміти такі концепції, як запити, доповнення, та вибрати бібліотеку для роботи. Саме це ви й вивчите в цьому розділі.
# 
# ## Вступ
# 
# У цьому розділі ви:
# 
# - Дізнаєтеся про бібліотеку openai та її основні концепції.
# - Створите додаток для генерації тексту за допомогою openai.
# - Зрозумієте, як використовувати такі концепції, як запит, температура та токени для створення додатку генерації тексту.
# 
# ## Навчальні цілі
# 
# Наприкінці цього уроку ви зможете:
# 
# - Пояснити, що таке додаток для генерації тексту.
# - Створити додаток для генерації тексту за допомогою openai.
# - Налаштувати ваш додаток для використання більшої чи меншої кількості токенів, а також змінювати температуру для отримання різноманітних результатів.
# 
# ## Що таке додаток для генерації тексту?
# 
# Зазвичай, коли ви створюєте додаток, він має певний інтерфейс, наприклад:
# 
# - Командний. Консольні додатки - це типові додатки, де ви вводите команду, і вона виконує завдання. Наприклад, `git` - це додаток на основі команд.
# - Інтерфейс користувача (UI). Деякі додатки мають графічні інтерфейси користувача (GUI), де ви натискаєте кнопки, вводите текст, вибираєте опції тощо.
# 
# ### Консольні та UI додатки обмежені
# 
# Порівняйте з додатком на основі команд, де ви вводите команду:
# 
# - **Він обмежений**. Ви не можете просто ввести будь-яку команду, лише ті, які підтримує додаток.
# - **Мовно-специфічний**. Деякі додатки підтримують багато мов, але за замовчуванням додаток створюється для конкретної мови, навіть якщо ви можете додати підтримку інших мов.
# 
# ### Переваги додатків для генерації тексту
# 
# Так чим же відрізняється додаток для генерації тексту?
# 
# У додатку для генерації тексту ви маєте більше гнучкості, ви не обмежені набором команд чи конкретною мовою введення. Натомість ви можете використовувати природну мову для взаємодії з додатком. Іншою перевагою є те, що ви вже взаємодієте з джерелом даних, яке навчене на величезному корпусі інформації, тоді як традиційний додаток може бути обмежений тим, що є в базі даних.
# 
# ### Що я можу створити за допомогою додатку для генерації тексту?
# 
# Ви можете створити багато речей. Наприклад:
# 
# - **Чат-бот**. Чат-бот, що відповідає на запитання про теми, такі як ваша компанія та її продукти, може бути хорошим варіантом.
# - **Помічник**. LLM чудово справляються з такими завданнями, як узагальнення тексту, отримання інформації з тексту, створення тексту, такого як резюме та інше.
# - **Помічник з кодом**. Залежно від мовної моделі, яку ви використовуєте, ви можете створити помічника з кодом, який допомагає вам писати код. Наприклад, ви можете використовувати такий продукт, як GitHub Copilot, а також ChatGPT, щоб допомогти вам писати код.
# 
# ## Як я можу почати?
# 
# Ну, вам потрібно знайти спосіб інтеграції з LLM, що зазвичай передбачає наступні два підходи:
# 
# - Використання API. Тут ви створюєте веб-запити з вашим запитом і отримуєте назад згенерований текст.
# - Використання бібліотеки. Бібліотеки допомагають інкапсулювати API-виклики та роблять їх простішими у використанні.
# 
# ## Бібліотеки/SDK
# 
# Існує кілька відомих бібліотек для роботи з LLM, таких як:
# 
# - **openai**, ця бібліотека полегшує підключення до вашої моделі та надсилання запитів.
# 
# Потім є бібліотеки, які працюють на вищому рівні, такі як:
# 
# - **Langchain**. Langchain добре відома і підтримує Python.
# - **Semantic Kernel**. Semantic Kernel - це бібліотека від Microsoft, що підтримує мови C#, Python та Java.
# 
# ## Перший додаток з використанням GitHub Models Playground та Azure AI Inference SDK
# 
# Давайте подивимося, як ми можемо створити наш перший додаток, які бібліотеки нам потрібні, скільки потрібно і так далі.
# 
# ### Що таке GitHub Models?
# 
# Ласкаво просимо до [GitHub Models](https://github.com/marketplace/models?WT.mc_id=academic-105485-koreyst)! У нас все готово для вас, щоб досліджувати різні моделі AI, розміщені на Azure AI, всі доступні через playground на GitHub або безперешкодно у вашому улюбленому IDE для коду, безкоштовно для спроби.
# 
# ### Що мені потрібно?
# 
# * Обліковий запис GitHub: [github.com/signup](https://github.com/signup?WT.mc_id=academic-105485-koreyst)
# * Зареєструватися для GitHub Models: [github.com/marketplace/models/waitlist](https://GitHub.com/marketplace/models/waitlist?WT.mc_id=academic-105485-koreyst)
# 
# Розпочнімо!
# 
# ### Знайдіть модель та протестуйте її
# 
# Перейдіть до [GitHub Models у Marketplace](https://github.com/marketplace/models?WT.mc_id=academic-105485-koreyst)
# 
# ![Головний екран GitHub Models, що показує список карток моделей, таких як Cohere, Meta llama, Mistral та моделі GPT](../images/GithubModelsMainScreen.png?WT.mc_id=academic-105485-koreyst)
# 
# Виберіть модель - наприклад [Open AI GPT-4o](https://github.com/marketplace/models/azure-openai/gpt-4o?WT.mc_id=academic-105485-koreyst)
# 
# Тут ви побачите картку моделі. Ви можете:
# * Взаємодіяти з моделлю прямо там, ввівши повідомлення в текстове поле
# * Ви можете прочитати деталі про модель у вкладках readme, Evaluation, Transparency та License
# * А також переглянути розділ 'About' для доступу до моделі праворуч
# 
# ![Картка моделі GitHub Models GPT-4o](../images/GithubModels-modelcard.png?WT.mc_id=academic-105485-koreyst)
# 
# Але ми перейдемо безпосередньо до playground, натиснувши кнопку ['Playground', вгорі праворуч](https://github.com/marketplace/models/azure-openai/gpt-4o/playground?WT.mc_id=academic-105485-koreyst). Ви можете взаємодіяти з моделлю тут, додавати системні запити та змінювати параметри - але також отримати весь код, який вам потрібен для роботи звідусіль. Доступно з вересня 2024 року: Python, Javascript, C# та REST.
# 
# ![Досвід роботи з GitHub Models Playground з відображенням коду та мов](../images/GithubModels-plagroundcode.png?WT.mc_id=academic-105485-koreyst)  
# 
# 
# ### Використовуємо модель у нашому власному IDE
# 
# Є два варіанти:
# 1. **GitHub Codespaces** - безперешкодна інтеграція з Codespaces і не потрібен токен для початку роботи
# 2. **VS Code (або будь-який улюблений IDE)** - потрібно отримати [Персональний Токен Доступу з GitHub](https://github.com/settings/tokens?WT.mc_id=academic-105485-koreyst)
# 
# 
# В будь-якому випадку, інструкції надаються через зелену кнопку 'Get started' вгорі праворуч.
# 
# ![Екран Get Started показує, як отримати доступ до Codespaces або використовувати персональний токен доступу для налаштування у вашому власному IDE](../images/GithubModels-getstarted.png?WT.mc_id=academic-105485-koreyst)
# 
# ### 1.Codespaces 
# 
# * З вікна 'Get started' виберіть "Run codespace"
# * Створіть новий codespace (або використовуйте існуючий)
# * VS Code відкриється у вашому браузері з набором тестових блокнотів на різних мовах, які ви можете спробувати
# * Запустіть зразок ```./githubmodels-app.py```. 
# 
# > Примітка: У codespaces немає необхідності встановлювати змінну Github Token, пропустіть цей крок
# 
# **Тепер перейдіть до розділу 'Generate Text' нижче, щоб продовжити це завдання**
# 
# ### 2. VS Code (або будь-який улюблений IDE)
# 
# З зеленої кнопки 'Get started' у вас є вся інформація, яка вам потрібна для запуску у вашому улюбленому IDE. Цей приклад покаже VS Code
# 
# * Виберіть мову та SDK - у цьому прикладі ми вибираємо Python та Azure AI Inference SDK
# * Створіть персональний токен доступу на GitHub. Він знаходиться в розділі Developer Settings. Вам не потрібно надавати будь-які дозволи для токена. Зауважте, що токен буде надіслано до сервісу Microsoft.
# * Створіть змінну середовища для зберігання вашого персонального токена доступу GitHub - приклади доступні для bash, powershell та Windows command prompt
# * Встановіть залежності: ```pip install azure-ai-inference```
# * Скопіюйте базовий зразок коду у файл .py
# * перейдіть до місця, де збережено ваш код, і запустіть файл: ```python filename.py```
# 
# Не забувайте, що використовуючи Azure AI Inference SDK, ви можете легко експериментувати з різними моделями, змінюючи значення `model_name` у коді.
# 
# Наступні моделі доступні в сервісі GitHub Models станом на вересень 2024 року:
# 
# * AI21 Labs: AI21-Jamba-1.5-Large, AI21-Jamba-1.5-Mini, AI21-Jamba-Instruct
# * Cohere: Cohere-Command-R, Cohere-Command-R-Plus, Cohere-Embed-v3-Multilingual, Cohere-Embed-v3-English
# * Meta: Meta-Llama-3-70B-Instruct, Meta-Llama-3-8B-Instruct, Meta-Llama-3.1-405B-Instruct, Meta-Llama-3.1-70B-Instruct, Meta-Llama-3.1-8B-Instruct
# * Mistral AI: Mistral-Large, Mistral-Large-2407, Mistral-Nemo, Mistral-Small
# * Microsoft: Phi-3-mini-4k-instruct, Phi-3.5-mini-128k-instruct, Phi-3-small-4k-instruct, Phi-3-small-128k-instruct, Phi-3-medium-4k-instruct, Phi-3-medium-128k-instruct, Phi-3.5-vision-128k-instruct
# * OpenAI: OpenAI-GPT-4o, Open-AI-GPT-4o-mini, OpenAI-Textembedding-3-large, OpenAI-Textembedding-3-small
# 
# 
# 
# **Тепер перейдіть до розділу 'Generate Text' нижче, щоб продовжити це завдання**
# 
# ## Генерація тексту з ChatCompletions
# 
# Спосіб генерації тексту - використовувати клас `ChatCompletionsClient`.
# У `samples/python/azure_ai_inference/basic.py`, в секції коду відповіді, оновіть код ролі користувача, змінивши параметр content на наступний:
# 
# ```python
# 
# response = client.complete(
#     messages=[
#         {
#             "role": "system",
#             "content": "You are a helpful assistant.",
#         },
#         {
#             "role": "user",
#             "content": "Complete the following: Once upon a time there was a",
#         },
#     ],
#     model=model_name,
#     # Optional parameters
#     temperature=1.,
#     max_tokens=1000,
#     top_p=1.    
# )
# 
# ```
# 
# Запустіть оновлений файл, щоб побачити результат

# %% [markdown]
# ## Різні типи запитів для різних завдань
# 
# Тепер ви бачили, як генерувати текст за допомогою запиту. У вас навіть є програма, яку ви можете змінювати та адаптувати для генерації різних типів тексту.
# 
# Запити можна використовувати для різноманітних завдань. Наприклад:
# 
# - **Генерація типу тексту**. Наприклад, ви можете генерувати вірш, питання для вікторини тощо.
# - **Пошук інформації**. Ви можете використовувати запити для пошуку інформації, як у наступному прикладі 'Що означає CORS у веб-розробці?'.
# - **Генерація коду**. Ви можете використовувати запити для генерації коду, наприклад, розробки регулярного виразу для перевірки електронних адрес або навіть генерації цілої програми, як-от веб-додаток?  
# 
# ## Вправа: генератор рецептів
# 
# Уявіть, що у вас є інгредієнти вдома і ви хочете щось приготувати. Для цього вам потрібен рецепт. Один із способів знайти рецепти - це використовувати пошукову систему, або ви можете використовувати LLM для цього.
# 
# Ви могли б написати запит, наприклад:
# 
# > "Покажи мені 5 рецептів страви з наступними інгредієнтами: курка, картопля та морква. Для кожного рецепту перелічи всі використовувані інгредієнти"
# 
# З таким запитом ви можете отримати відповідь, подібну до:
# 
# ```output
# 1. Смажена курка з овочами: 
# Інгредієнти: 
# - 4 курячих стегна
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 2 столові ложки оливкової олії
# - 2 зубчики часнику, подрібнені
# - 1 чайна ложка сушеного чебрецю
# - 1 чайна ложка сушеного орегано
# - Сіль та перець за смаком
# 
# 2. Куряче рагу з картоплею: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 1 цибулина, нарізана
# - 2 зубчики часнику, подрібнені
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 чайна ложка сушеного орегано
# - 1 чайна ложка сушеного чебрецю
# - 1 чашка курячого бульйону
# - Сіль та перець за смаком
# 
# 3. Запіканка з курки та картоплі: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 цибулина, нарізана
# - 2 зубчики часнику, подрібнені
# - 1 чайна ложка сушеного орегано
# - 1 чайна ложка сушеного чебрецю
# - 1 чашка курячого бульйону
# - Сіль та перець за смаком
# 
# 4. Курячий суп з картоплею: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 1 цибулина, нарізана
# - 2 зубчики часнику, подрібнені
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 чайна ложка сушеного орегано
# - 1 чайна ложка сушеного чебрецю
# - 4 чашки курячого бульйону
# - Сіль та перець за смаком
# 
# 5. Куряча та картопляна суміш: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 цибулина, нарізана
# - 2 зубчики часнику, подрібнені
# - 1 чайна ложка сушеного орегано
# ```
# 
# Цей результат чудовий, я знаю, що готувати. На цьому етапі, корисними покращеннями могли б бути:
# 
# - Фільтрація інгредієнтів, які мені не подобаються або на які у мене алергія.
# - Створення списку покупок, якщо у мене немає всіх інгредієнтів вдома.
# 
# Для вищезазначених випадків додамо додатковий запит:
# 
# > "Будь ласка, видаліть рецепти з часником, оскільки у мене на нього алергія, і замініть його чимось іншим. Також, будь ласка, створіть список покупок для рецептів, враховуючи, що у мене вже є курка, картопля та морква вдома."
# 
# Тепер у вас є новий результат, а саме:
# 
# ```output
# 1. Смажена курка з овочами: 
# Інгредієнти: 
# - 4 курячих стегна
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 2 столові ложки оливкової олії
# - 1 чайна ложка сушеного чебрецю
# - 1 чайна ложка сушеного орегано
# - Сіль та перець за смаком
# 
# 2. Куряче рагу з картоплею: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 1 цибулина, нарізана
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 чайна ложка сушеного орегано
# - 1 чайна ложка сушеного чебрецю
# - 1 чашка курячого бульйону
# - Сіль та перець за смаком
# 
# 3. Запіканка з курки та картоплі: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 цибулина, нарізана
# - 1 чайна ложка сушеного орегано
# - 1 чайна ложка сушеного чебрецю
# - 1 чашка курячого бульйону
# - Сіль та перець за смаком
# 
# 4. Курячий суп з картоплею: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 1 цибулина, нарізана
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 чайна ложка сушеного орегано
# - 1 чайна ложка сушеного чебрецю
# - 4 чашки курячого бульйону
# - Сіль та перець за смаком
# 
# 5. Куряча та картопляна суміш: 
# Інгредієнти: 
# - 2 столові ложки оливкової олії
# - 2 курячі грудки, нарізані кубиками
# - 2 картоплі, нарізані кубиками
# - 2 моркви, нарізані кубиками
# - 1 цибулина, нарізана
# - 1 чайна ложка сушеного орегано
# 
# Список покупок: 
# - Оливкова олія
# - Цибуля
# - Чебрець
# - Орегано
# - Сіль
# - Перець
# ```
# 
# Це ваші п'ять рецептів, без згадки про часник, і у вас також є список покупок, враховуючи те, що ви вже маєте вдома.

# %% [markdown]
# ## Вправа - створення генератора рецептів
# 
# Тепер, коли ми розглянули сценарій, давайте напишемо код, який відповідає продемонстрованому сценарію. Для цього виконайте наступні кроки:
# 
# 1. Використовуйте існуючий файл як початкову точку
# 1. Створіть змінну `prompt` і змініть зразок коду, як показано нижче:

# %%
import os
from azure.ai.inference import ChatCompletionsClient
from azure.ai.inference.models import SystemMessage, UserMessage
from azure.core.credentials import AzureKeyCredential

token = os.environ["GITHUB_TOKEN"]
endpoint = "https://models.inference.ai.azure.com"

model_name = "gpt-4o"

client = ChatCompletionsClient(
    endpoint=endpoint,
    credential=AzureKeyCredential(token),
)

prompt = "Покажи мені 5 рецептів для страви з наступними інгредієнтами: курка, картопля та морква. Для кожного рецепту перелічи всі використані інгредієнти"

response = client.complete(
    messages=[
        {
            "role": "system",
            "content": "Ти корисний асистент.",
        },
        {
            "role": "user",
            "content": prompt,
        },
    ],
    model=model_name,
    # Опціональні параметри
    temperature=1.,
    max_tokens=1000,
    top_p=1.    
)

print(response.choices[0].message.content)

# %%


# %% [markdown]
# Якщо ви зараз запустите код, ви повинні побачити результат, подібний до:
# 
# ```output
# ### Рецепт 1: Класичне куряче рагу
# #### Інгредієнти:
# - 2 фунти курячих стегон або гомілок, без шкіри
# - 4 чашки курячого бульйону
# - 4 середні картоплини, очищені та нарізані кубиками
# - 4 великі моркви, очищені та нарізані скибочками
# - 1 велика цибулина, нарізана
# - 2 зубчики часнику, подрібнені
# - 2 стебла селери, нарізані
# - 1 чайна ложка сушеного чебрецю
# - 1 чайна ложка сушеного розмарину
# - Сіль та перець за смаком
# - 2 столові ложки оливкової олії
# - 2 столові ложки борошна (опціонально, для загущення)
# 
# ### Рецепт 2: Запечена курка з овочами
# #### Інгредієнти:
# - 4 курячі грудки або стегна
# - 4 середні картоплини, нарізані часточками
# - 4 великі моркви, нарізані паличками
# - 1 велика цибулина, нарізана часточками
# - 3 зубчики часнику, подрібнені
# - 1/4 чашки оливкової олії 
# - 1 чайна ложка паприки
# - 1 чайна ложка сушеного орегано
# - Сіль та перець за смаком
# - Сік одного лимона
# - Свіжа петрушка, подрібнена (для прикраси)
# (продовження ...)
# ```
# 
# > ПРИМІТКА: ваша LLM є недетермінованою, тому ви можете отримувати різні результати кожного разу, коли запускаєте програму.
# 
# Чудово, давайте подивимося, як ми можемо покращити речі. Щоб покращити речі,
# %% [markdown]
# ми хочемо переконатися, що код є гнучким, щоб інгредієнти та кількість рецептів можна було легко змінювати та адаптувати.

# %% [markdown]
# 1. Змінимо код наступним чином:

# %%
import os
from azure.ai.inference import ChatCompletionsClient
from azure.ai.inference.models import SystemMessage, UserMessage
from azure.core.credentials import AzureKeyCredential

token = os.environ["GITHUB_TOKEN"]
endpoint = "https://models.inference.ai.azure.com"

model_name = "gpt-4o"

client = ChatCompletionsClient(
    endpoint=endpoint,
    credential=AzureKeyCredential(token),
)

no_recipes = input("Кількість рецептів (наприклад, 5): ")

ingredients = input("Список інгредієнтів (наприклад, курка, картопля та морква): ")

# інтерполюємо кількість рецептів у запит та інгредієнти
prompt = f"Покажи мені {no_recipes} рецептів для страви з наступними інгредієнтами: {ingredients}. Для кожного рецепту перелічи всі використані інгредієнти"

response = client.complete(
    messages=[
        {
            "role": "system",
            "content": "Ти корисний асистент.",
        },
        {
            "role": "user",
            "content": prompt,
        },
    ],
    model=model_name,
    # Опціональні параметри
    temperature=1.,
    max_tokens=1000,
    top_p=1.    
)

print(response.choices[0].message.content)

# %% [markdown]
# 
# Тестовий запуск коду може виглядати так:
#     
# ```output
# Кількість рецептів (наприклад, 5): 2
# Список інгредієнтів (наприклад, курка, картопля та морква): молоко, полуниця
# 
# Звичайно! Ось два рецепти з молоком та полуницею:
# 
# ### Рецепт 1: Полуничний молочний коктейль
# 
# #### Інгредієнти:
# - 1 склянка молока
# - 1 склянка полуниці, очищеної від плодоніжок і нарізаної
# - 2 столові ложки цукру (за бажанням, за смаком)
# - 1/2 чайної ложки ванільного екстракту
# - 5-6 кубиків льоду
# 
# #### Інструкції:
# 1. Поєднайте молоко, полуницю, цукор (якщо використовуєте) та ванільний екстракт у блендері.
# 2. Змішайте на високій швидкості до однорідної кремоподібної консистенції.
# 3. Додайте кубики льоду і знову змішайте, поки лід повністю не подрібниться, а коктейль не стане пінистим.
# 4. Вилийте у склянку і відразу подавайте.
# 
# ### Рецепт 2: Полунична панна котта
# 
# #### Інгредієнти:
# - 1 склянка молока
# - 1 склянка полуниці, очищеної від плодоніжок і пюрованої
# - 1/4 склянки цукру
# - 1 чайна ложка ванільного екстракту
# - 1 пакетик желатину без смаку (близько 2 1/2 чайних ложок)
# - 2 столові ложки холодної води
# - 1 склянка вершків
# 
# #### Інструкції:
# 1. Посипте желатин на холодну воду в маленькій мисці та дайте йому настоятися близько 5-10 хвилин для розм'якшення.
# 2. У каструлі поєднайте молоко, вершки та цукор. Готуйте на середньому вогні, часто помішуючи, поки цукор не розчиниться, і суміш не почне кипіти. Не дозволяйте їй закипіти.
# 3. Зніміть каструлю з вогню і додайте розм'якшений желатин, помішуючи, поки він повністю не розчиниться.
# 4. Додайте ванільний екстракт і дайте суміші трохи охолонути.
# 5. Розділіть суміш рівномірно у склянки для подачі або форми та охолодіть щонайменше 4 години або до застигання.
# 6. Для приготування полуничного пюре змішайте полуницю до однорідності.
# 7. Коли панна котта застигне, полийте кожну панна котту полуничним пюре зверху.
# 8. Подавайте охолодженою.
# 
# Смачного!
# ```
# 
# ### Покращення шляхом додавання фільтра та списку покупок
# 
# Тепер у нас є працюючий додаток, здатний створювати рецепти, і він гнучкий, оскільки спирається на введення користувача, як щодо кількості рецептів, так і використаних інгредієнтів.
# 
# Для подальшого вдосконалення ми хочемо додати наступне:
# 
# - **Фільтрувати інгредієнти**. Ми хочемо мати можливість фільтрувати інгредієнти, які нам не подобаються або на які у нас алергія. Щоб виконати цю зміну, ми можемо відредагувати наш існуючий запит і додати умову фільтра в кінці, ось так:
# 
#     ```python
#     filter = input("Фільтр (наприклад, вегетаріанський, веганський або без глютену: ")
# 
#     prompt = f"Покажи мені {no_recipes} рецептів для страви з наступними інгредієнтами: {ingredients}. Для кожного рецепту перелічи всі використані інгредієнти, без {filter}"
#     ```
# 
#     Вище ми додаємо `{filter}` в кінці запиту, а також отримуємо значення фільтра від користувача.
# 
#     Приклад введення при запуску програми тепер може виглядати так:
#     
#     ```output    
#     Кількість рецептів (наприклад, 5): 2
#     Список інгредієнтів (наприклад, курка, картопля та морква): цибуля, молоко
#     Фільтр (наприклад, вегетаріанський, веганський або без глютену: без молока
#     Звичайно! Ось два рецепти з використанням цибулі, але без молока:
#     
#     ### Рецепт 1: Карамелізована цибуля
#     
#     #### Інгредієнти:
#     - 4 великі цибулини, тонко нарізані
#     - 2 столові ложки оливкової олії
#     - 1 столова ложка вершкового масла
#     - 1 чайна ложка солі
#     - 1 чайна ложка цукру (за бажанням)
#     - 1 столова ложка бальзамічного оцту (за бажанням)
#     
#     #### Інструкції:
#     1. Нагрійте оливкову олію та вершкове масло у великій сковороді на середньому вогні, поки масло не розтопиться.
#     2. Додайте цибулю і перемішайте, щоб покрити її сумішшю олії та масла.
#     3. Додайте сіль (і цукор, якщо використовуєте) до цибулі.
#     4. Готуйте цибулю, періодично помішуючи, приблизно 45 хвилин-годину, поки вона не стане золотисто-коричневою і карамелізованою.
#     5. Якщо використовуєте, додайте бальзамічний оцет протягом останніх 5 хвилин приготування.
#     6. Зніміть з вогню і подавайте як топінг для бургерів, стейка або як гарнір.
#     
#     ### Рецепт 2: Французький цибулевий суп
#     
#     #### Інгредієнти:
#     - 4 великі цибулини, тонко нарізані
#     - 3 столові ложки несоленого вершкового масла
#     - 2 зубчики часнику, подрібнені
#     - 1 чайна ложка цукру
#     - 1 чайна ложка солі
#     - 1/4 склянки сухого білого вина (за бажанням)
#     - 4 склянки яловичого бульйону
#     - 4 склянки курячого бульйону
#     - 1 лавровий лист
#     - 1 чайна ложка свіжого подрібненого чебрецю (або 1/2 чайної ложки сушеного чебрецю)
#     - 1 багет, нарізаний
#     - 2 склянки тертого сиру Грюєр
#     
#     #### Інструкції:
#     1. Розтопіть масло у великій каструлі на середньому вогні.
#     2. Додайте цибулю, часник, цукор і сіль, і готуйте, часто помішуючи, поки цибуля не стане глибоко карамелізованою (приблизно 30-35 хвилин).
#     3. Якщо використовуєте, додайте біле вино і готуйте, поки воно не випарується, приблизно 3-5 хвилин.
#     4. Додайте яловичий і курячий бульйони, лавровий лист і чебрець. Доведіть до кипіння і готуйте ще 30 хвилин. Видаліть лавровий лист.
#     5. Розігрійте духовку до 400°F (200°C).
#     6. Покладіть скибочки багета на деко і підсмажте їх у розігрітій духовці до золотисто-коричневого кольору, приблизно 5 хвилин.
#     7. Розлийте суп у вогнетривкі миски і покладіть скибочку підсмаженого багета на кожну миску.
#     8. Щедро посипте тертим сиром Грюєр поверх скибочок багета.
#     9. Поставте миски під гриль, поки сир не розплавиться і не стане бульбашковим, приблизно 3-5 хвилин.
#     10. Подавайте гарячим.
#     
#     Насолоджуйтесь своїми смачними стравами з цибулі!
#     ```
#     
# - **Створення списку покупок**. Ми хочемо створити список покупок, враховуючи те, що у нас вже є вдома.
# 
#     Для цієї функціональності ми могли б спробувати вирішити все в одному запиті або розділити його на два запити. Давайте спробуємо останній підхід. Тут ми пропонуємо додати додатковий запит, але для того, щоб це працювало, нам потрібно додати результат попереднього запиту як контекст до наступного запиту.
#     
#     Знайдіть частину коду, яка виводить результат від першого запиту, і додайте нижче наступний код:
#     
#     ```python
#     old_prompt_result = response.choices[0].message.content
#     prompt = "Створи список покупок для згенерованих рецептів і, будь ласка, не включай інгредієнти, які в мене вже є."
#         
#     new_prompt = f"{old_prompt_result} {prompt}"
#     
#     response = client.complete(
#         messages=[
#             {
#                 "role": "system",
#                 "content": "Ти корисний асистент.",
#             },
#             {
#                 "role": "user",
#                 "content": new_prompt,
#             },
#         ],
#         model=model_name,
#         # Опціональні параметри
#         temperature=1.,
#         max_tokens=1200,
#         top_p=1.    
#     )
#         
#     # виведення відповіді
#     print("Список покупок:")
#     print(response.choices[0].message.content)
#     ```
# 
# 
#     Зауважте наступне:
# 
#     - Ми створюємо новий запит, додаючи результат першого запиту до нового запиту: 
#     
#         ```python
#         new_prompt = f"{old_prompt_result} {prompt}"
#         messages = [{"role": "user", "content": new_prompt}]
#         ```
# 
#     - Ми робимо новий запит, але також беремо до уваги кількість токенів, які ми запитали в першому запиті, тому цього разу ми кажемо, що `max_tokens` дорівнює 1200. **Слово про довжину токена**. Ми повинні враховувати, скільки токенів нам потрібно для генерації тексту, який ми хочемо. Токени коштують грошей, тому, де це можливо, ми повинні намагатися бути економними з кількістю використовуваних токенів. Наприклад, чи можемо ми сформулювати запит так, щоб використовувати менше токенів?
# 
#         ```python
#         response = client.complete(
#             messages=[
#                 {
#                     "role": "system",
#                     "content": "Ти корисний асистент.",
#                 },
#                 {
#                     "role": "user",
#                     "content": new_prompt,
#                 },
#             ],
#             model=model_name,
#             # Опціональні параметри
#             temperature=1.,
#             max_tokens=1200,
#             top_p=1.    
#         )    
#         ```  
# 
#         Запустивши цей код, ми отримаємо наступний результат:
# 
#         ```output
#         Кількість рецептів (наприклад, 5): 1
#         Список інгредієнтів (наприклад, курка, картопля та морква): полуниця, молоко
#         Фільтр (наприклад, вегетаріанський, веганський або без глютену): горіхи
#         
#         Звичайно! Ось простий і смачний рецепт полуничного молочного коктейлю з використанням полуниці та молока як основних інгредієнтів:
#         
#         ### Полуничний молочний коктейль
#         
#         #### Інгредієнти:
#         - 1 склянка свіжої полуниці, очищеної
#         - 1 склянка холодного молока
#         - 1 столова ложка меду або цукру (за бажанням, за смаком)
#         - 1/2 чайної ложки ванільного екстракту (за бажанням)
#         - 3-4 кубики льоду
#         
#         #### Інструкції:
#         1. Вимийте та очистіть полуницю, потім розріжте її навпіл.
#         2. У блендері поєднайте полуницю, холодне молоко, мед або цукор (якщо використовуєте), ванільний екстракт (якщо використовуєте) та кубики льоду.
#         3. Змішайте до однорідної та пінистої консистенції.
#         4. Вилийте коктейль у склянку.
#         5. Відразу подавайте і насолоджуйтеся освіжаючим полуничним молочним коктейлем!
#         
#         Цей рецепт не містить горіхів і являє собою чудовий і швидкий десерт!
#         Список покупок:
#         Звичайно! Ось список покупок для рецепту Полуничного молочного коктейлю на основі наданих інгредієнтів. Будь ласка, відрегулюйте відповідно до того, що у вас вже є вдома:
#         
#         ### Список покупок:
#         - Свіжа полуниця (1 склянка)
#         - Молоко (1 склянка)
#         
#         За бажанням:
#         - Мед або цукор (1 столова ложка)
#         - Ванільний екстракт (1/2 чайної ложки)
#         - Кубики льоду (3-4)
#         
#         Не соромтеся пропустити необов'язкові інгредієнти, якщо ви віддаєте перевагу або якщо вони у вас вже є. Насолоджуйтеся вашим смачним полуничним молочним коктейлем!
#         ```
#         
# - **Експериментування з температурою**. Температура - це те, про що ми ще не згадували, але це важливий контекст для того, як працює наша програма. Чим вище значення температури, тим більш випадковим буде вихід. І навпаки, чим нижче значення температури, тим більш передбачуваним буде вихід. Подумайте, чи хочете ви варіації у вашому виході чи ні.
# 
#    Щоб змінити температуру, ви можете використовувати параметр `temperature`. Наприклад, якщо ви хочете використовувати температуру 0.5, ви б зробили:
# 
# ```python
#     response = client.complete(
#         messages=[
#             {
#                 "role": "system",
#                 "content": "Ти корисний асистент.",
#             },
#             {
#                 "role": "user",
#                 "content": new_prompt,
#             },
#         ],
#         model=model_name,
#         # Опціональні параметри
#         temperature=0.5,
#         max_tokens=1200,
#         top_p=1.    
#     )
# ```
# 
#    > Примітка: чим ближче до 1.0, тим більш різноманітним буде вихід.
# 
# 
# ## Завдання
# 
# Для цього завдання ви можете вибрати, що будувати.
# 
# Ось кілька пропозицій:
# 
# - Налаштуйте додаток генератора рецептів, щоб ще більше покращити його. Поексперементуйте з значеннями температури та запитами, щоб подивитись, що ви можете створити.
# - Створіть "навчального приятеля". Цей додаток повинен бути здатним відповідати на запитання про тему, наприклад Python, ви можете мати запити на зразок "Що таке певна тема в Python?", або ви можете мати запит, який говорить, покажи мені код для певної теми тощо.
# - Історичний бот, оживіть історію, дайте боту інструкції грати певний історичний персонаж і задавайте йому питання про його життя та часи.
# 
# ## Рішення
# 
# ### Навчальний приятель
# 
# - "Ти експерт з мови Python
# 
#     Запропонуй урок для початківців з Python у наступному форматі:
#     
#     Формат:
#     - концепції:
#     - коротке пояснення уроку:
#     - вправа в коді з рішеннями"
# 
# Вище наведено початковий запит, подивіться, як ви можете використовувати його і налаштувати на свій смак.
# 
# ### Історичний бот
# 
# Ось кілька запитів, які ви могли б використовувати:
# 
# - "Ти Авраам Лінкольн, розкажи мені про себе в 3 реченнях, і відповідай, використовуючи граматику і слова, як би використовував Ейб"
# - "Ти Авраам Лінкольн, відповідай, використовуючи граматику і слова, як би використовував Ейб:
# 
#    Розкажи мені про свої найбільші досягнення, в 300 словах:"
# 
# ## Перевірка знань
# 
# Що робить концепція температури?
# 
# 1. Вона контролює, наскільки випадковим є вихід.
# 1. Вона контролює, наскільки великою є відповідь.
# 1. Вона контролює, скільки токенів використовується.
# 
# В: 1
# 
# Який хороший спосіб зберігати секрети, такі як ключі API?
# 
# 1. У коді.
# 1. У файлі.
# 1. У змінних середовища.
# 
# В: 3, тому що змінні середовища не зберігаються в коді і можуть бути завантажені з коду.